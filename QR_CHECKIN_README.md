# 二维码签到功能使用说明

## 功能概述

智慧实验室电子班牌系统新增了二维码签到功能，支持多种签到方式：

1. **扫脸签到** - 通过人脸识别技术进行签到
2. **小程序签到** - 通过微信小程序等移动端应用签到
3. **二维码扫描签到** - 通过扫描每日更新的二维码进行签到

## 二维码签到特点

### 🔒 安全性
- 二维码每日自动更新，防止重复使用
- 基于日期和密钥生成唯一token
- 服务器端验证token有效性

### 📱 便捷性
- 美观的移动端适配界面
- 支持情绪状态选择
- 实时反馈签到结果

### ⏰ 时效性
- 二维码当日有效，次日自动失效
- 每小时自动刷新二维码
- 防止过期二维码被恶意使用

## 使用方法
### 1. 访问二维码显示页面

打开浏览器访问：`http://127.0.0.1:5000/qr-display`

### 2. 扫描二维码

- 页面会自动生成当日有效的二维码
- 使用手机扫描二维码，会自动跳转到签到页面
- 二维码包含加密的签到链接和token信息
- 二维码每小时自动刷新，确保安全性

### 3. 填写签到信息

扫描二维码后会跳转到签到确认页面：
- **姓名**：输入您在系统中注册的真实姓名
- **心情状态**（可选）：选择当前的心情状态
  - 😊 开心
  - 😌 平静
  - 🤔 专注
  - 😴 疲惫
  - 🤩 兴奋

### 4. 确认签到

点击"确认签到"按钮完成签到流程，系统会自动验证token有效性。

## API接口说明
### 生成每日token

```http
GET /api/v1/attendance/qr-code
```

返回当日有效的token和日期信息。

### 生成二维码图片

```http
POST /api/v1/attendance/qr-code-url
Content-Type: application/json

{
  "url": "签到页面URL",
  "token": "当日token",
  "date": "当前日期"
}
```

返回包含Base64编码的二维码图片。

### 二维码签到

```http
POST /api/v1/attendance/qr-checkin
Content-Type: application/json

{
  "token": "当日token",
  "user_name": "用户姓名",
  "emotion_status": "心情状态"
}
```

## 技术实现
### 系统架构

**两步式签到流程：**
1. **二维码显示页面** (`/qr-display`) - 展示每日更新的二维码
2. **签到确认页面** (`/checkin`) - 扫码后跳转的签到表单页面

### 后端技术

- **Flask** - Web框架
- **qrcode** - 二维码生成库
- **hashlib** - 加密算法
- **SQLAlchemy** - 数据库ORM
- **URL参数传递** - token和日期验证

### 前端技术
- **HTML5** - 页面结构
- **CSS3** - 样式设计（渐变背景、响应式布局）
- **JavaScript** - 交互逻辑和URL参数解析
- **Fetch API** - 异步请求
- **URLSearchParams** - URL参数处理

### 安全机制
- 基于日期和密钥的SHA256加密
- Token每日更新，防止重放攻击
- URL参数验证，防止直接访问
- 服务器端验证用户存在性
- 防止重复签到检查
- 二维码每小时自动刷新

## 错误处理

系统会处理以下常见错误：

- ❌ 二维码已过期或无效
- ❌ 用户不存在，请检查姓名
- ❌ 今日已签到
- ❌ 请填写姓名
- ❌ 缺少二维码token

## 移动端适配

页面针对移动设备进行了优化：

- 响应式设计，适配不同屏幕尺寸
- 触摸友好的按钮设计
- 清晰的视觉层次
- 流畅的交互动画

## 注意事项

1. **姓名匹配**：请确保输入的姓名与系统中注册的姓名完全一致
2. **网络连接**：需要稳定的网络连接来生成二维码和提交签到
3. **浏览器兼容**：建议使用现代浏览器（Chrome、Safari、Firefox等）
4. **时间同步**：确保设备时间准确，避免token验证失败

## 未来扩展

- 支持批量签到
- 集成人脸识别API
- 微信小程序集成
- 签到统计报表
- 地理位置验证

---

© 2024 智慧实验室电子班牌系统